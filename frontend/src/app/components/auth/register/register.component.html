<div class="register-container">
  <div class="register-card">
    <!-- Header -->
    <div class="register-header">
      <div class="logo">
        <i class="fas fa-user-plus"></i>
      </div>
      <h1>Unisciti a noi!</h1>
      <p>Crea il tuo account su FAKERESTAURANT e inizia a condividere le tue esperienze</p>
    </div>

    <!-- Loading Spinner -->
    @if (loading) {
      <div class="loading-overlay">
        <div class="spinner"></div>
      </div>
    }

    <!-- Messaggi di errore -->
    @if (errorMessage) {
      <div class="error-message">
        <i class="fas fa-exclamation-circle"></i>
        {{ errorMessage }}
      </div>
    }

    <!-- Form di registrazione -->
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
      
      <!-- Campo Username -->
      <div class="form-group">
        <label for="username">
          <i class="fas fa-user"></i>
          Nome Utente*
        </label>
        <input
          type="text"
          id="username"
          formControlName="username"
          placeholder="Scegli un nome utente univoco"
          (input)="clearMessages()"
          [class.error]="usernameControl?.invalid && usernameControl?.touched"
          autocomplete="username">
        
        <small class="helper-text">
          3-20 caratteri. Solo lettere, numeri e underscore.
        </small>
        
        @if (usernameControl?.invalid && usernameControl?.touched) {
          <div class="validation-errors">
            <span class="error-text">
              <i class="fas fa-exclamation-triangle"></i>
              {{ getErrorMessage('username') }}
            </span>
          </div>
        }
      </div>

      <!-- Campo Email -->
      <div class="form-group">
        <label for="email">
          <i class="fas fa-envelope"></i>
          Email*
        </label>
        <input
          type="email"
          id="email"
          formControlName="email"
          placeholder="tua@email.com"
          (input)="clearMessages()"
          [class.error]="emailControl?.invalid && emailControl?.touched"
          autocomplete="email">
        
        @if (emailControl?.invalid && emailControl?.touched) {
          <div class="validation-errors">
            <span class="error-text">
              <i class="fas fa-exclamation-triangle"></i>
              {{ getErrorMessage('email') }}
            </span>
          </div>
        }
      </div>

      <!-- Campo Password -->
      <div class="form-group">
        <label for="password">
          <i class="fas fa-lock"></i>
          Password*
        </label>
        <div class="password-input-wrapper">
          <input
            [type]="showPassword ? 'text' : 'password'"
            id="password"
            formControlName="password"
            placeholder="Crea una password sicura"
            (input)="clearMessages()"
            [class.error]="passwordControl?.invalid && passwordControl?.touched"
            autocomplete="new-password">
          
          <button
            type="button"
            class="toggle-password"
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="showPassword ? 'Nascondi password' : 'Mostra password'">
            <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>

        <!-- Indicatore forza password -->
        @if (passwordControl?.value) {
          <div class="password-strength">
            <div class="strength-bar">
              <div 
                class="strength-fill" 
                [style.width.%]="getPasswordStrength().strength"
                [style.background-color]="getPasswordStrength().color">
              </div>
            </div>
            <span 
              class="strength-label"
              [style.color]="getPasswordStrength().color">
              {{ getPasswordStrength().label }}
            </span>
          </div>
        }

        <!-- Requisiti password -->
        <div class="password-requirements">
          <div class="requirement" [class.met]="passwordRequirements.minLength">
            <i [class]="passwordRequirements.minLength ? 'fas fa-check-circle' : 'far fa-circle'"></i>
            Almeno 6 caratteri
          </div>
          <div class="requirement" [class.met]="passwordRequirements.hasLetter">
            <i [class]="passwordRequirements.hasLetter ? 'fas fa-check-circle' : 'far fa-circle'"></i>
            Almeno una lettera
          </div>
          <div class="requirement" [class.met]="passwordRequirements.hasNumber">
            <i [class]="passwordRequirements.hasNumber ? 'fas fa-check-circle' : 'far fa-circle'"></i>
            Almeno un numero
          </div>
        </div>
        
        @if (passwordControl?.invalid && passwordControl?.touched) {
          <div class="validation-errors">
            <span class="error-text">
              <i class="fas fa-exclamation-triangle"></i>
              {{ getErrorMessage('password') }}
            </span>
          </div>
        }
      </div>

      <!-- Campo Conferma Password -->
      <div class="form-group">
        <label for="confirmPassword">
          <i class="fas fa-lock"></i>
          Conferma Password*
        </label>
        <div class="password-input-wrapper">
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmPassword"
            formControlName="confirmPassword"
            placeholder="Ripeti la password"
            [class.error]="(confirmPasswordControl?.invalid && confirmPasswordControl?.touched) || passwordsDoNotMatch()"
            [class.success]="passwordRequirements.match && confirmPasswordControl?.touched"
            autocomplete="new-password">
          
          <button
            type="button"
            class="toggle-password"
            (click)="toggleConfirmPasswordVisibility()"
            [attr.aria-label]="showConfirmPassword ? 'Nascondi password' : 'Mostra password'">
            <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>

          @if (passwordRequirements.match && confirmPasswordControl?.value) {
            <i class="fas fa-check-circle success-icon"></i>
          }
        </div>
        
        @if (passwordsDoNotMatch()) {
          <div class="validation-errors">
            <span class="error-text">
              <i class="fas fa-exclamation-triangle"></i>
              Le password non corrispondono
            </span>
          </div>
        }
      </div>

      <!-- Checkbox Termini e Condizioni -->
      <div class="form-group terms-group">
        <label class="checkbox-container">
          <input type="checkbox" formControlName="acceptTerms">
          <span class="checkmark"></span>
          <span class="checkbox-label">
            Accetto i 
            <a href="/terms" target="_blank">Termini e Condizioni</a> 
            e la 
            <a href="/privacy" target="_blank">Privacy Policy</a>*
          </span>
        </label>
        
        @if (acceptTermsControl?.invalid && acceptTermsControl?.touched) {
          <div class="validation-errors">
            <span class="error-text">
              <i class="fas fa-exclamation-triangle"></i>
              Devi accettare i termini per continuare
            </span>
          </div>
        }
      </div>

      <!-- Pulsante di submit -->
      <button 
        type="submit" 
        class="btn-submit"
        [disabled]="loading || registerForm.invalid">
        @if (!loading) {
          <span>
            <i class="fas fa-user-plus"></i>
            Crea Account
          </span>
        }
        @if (loading) {
          <span>
            <i class="fas fa-spinner fa-spin"></i>
            Creazione account...
          </span>
        }
      </button>

      <!-- Link al login -->
      <div class="login-link">
        <p>
          Hai gi√† un account?
          <a routerLink="/login" [queryParams]="{returnUrl: returnUrl}">
            Accedi ora
          </a>
        </p>
      </div>

      <!-- Divider -->
      <div class="divider">
        <span>oppure</span>
      </div>

      <!-- Link rapido per esplorare -->
      <a routerLink="/restaurants" class="btn-secondary">
        <i class="fas fa-compass"></i>
        Esplora senza registrarti
      </a>
    </form>
  </div>

  <!-- Decorazioni di sfondo -->
  <div class="background-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>
</div>
